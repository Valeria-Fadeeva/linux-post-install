# mkinitcpio preset file for the 'Lera Forest' package

KNAME="arch"

KVER=$(ls /usr/lib/modules/ | grep $KNAME | sort -V | tail -n 1)

if [[ -z "$KVER" ]]; then
    exit
fi

D=$(date +%Y.%m.%d-%H-%M-%S)

cp -vf /boot/amd-ucode.img /efi/EFI/Linux/
cp -vf /boot/intel-ucode.img /efi/EFI/Linux/
cp -vf /usr/lib/modules/$KVER/vmlinuz /efi/EFI/Linux/vmlinuz-$KNAME

ALL_config="/etc/mkinitcpio.conf"
ALL_kver="/usr/lib/modules/$KVER/vmlinuz"
ALL_microcode=(/boot/*-ucode.img)

PRESETS=('default' 'fallback')

#default_config="/etc/mkinitcpio.conf"
default_image="/efi/EFI/Linux/initramfs-$KNAME.img"
default_uki="/efi/EFI/Linux/linux-$KNAME.efi"
default_options="--cmdline /boot/cmdline.txt"

#fallback_config="/etc/mkinitcpio.conf"
fallback_image="/efi/EFI/Linux/initramfs-$KNAME-fallback.img"
fallback_uki="/efi/EFI/Linux/linux-$KNAME-fallback.efi"
fallback_options="-S autodetect --cmdline /boot/cmdline.txt"